<%- include('../partials/header') %>
  <link rel="stylesheet" href="/css/rentals-list.css" />
  <h3>Rentals for <%= user.firstName %>
      <%= user.lastName %>!</h3>
  <section class="rentals-list">
    <% if (sessions.length===0) { %>
      <p>You have no rental sessions yet.</p>
      <% } else { %>
        <table>
          <thead>
            <tr>
              <th>Vehicle</th>
              <th>Period</th>
              <th>Days</th>
              <th>Rate / day</th>
              <th>Total Fee</th>
              <th>Status</th>
              <th>Booked On</th>
            </tr>
          </thead>
          <tbody>
            <% sessions.forEach(session=> {
              const start = new Date(session.startDate);
              const end = new Date(session.endDate);
              const msPerDay = 1000 * 60 * 60 * 24;
              const days = Math.ceil((end - start) / msPerDay);
              const rate = session.vehicle.pricePerDay;
              const totalFee = (days * rate).toFixed(2);
              %>
              <tr>
                <td class="vehicle-cell">
                  <img src="<%= session.vehicle.imageUrl %>"
                    alt="<%= session.vehicle.make %> <%= session.vehicle.model %>" width="100" />
                  <div>
                    <strong>
                      <%= session.vehicle.make %>
                        <%= session.vehicle.model %> (<%= session.vehicle.year %>)
                    </strong><br />
                    VIN: <%= session.vehicle.vin %>
                  </div>
                </td>
                <!--
                <td>
                  <%= start.toLocaleString() %><br />
                    &mdash;
                    <%= end.toLocaleString() %>
                </td>
                -->

<td class="period-cell">
  <% 
    const dateOpts = { day: '2-digit', month: '2-digit', year: 'numeric' };
    const timeOpts = { hour: '2-digit', minute: '2-digit', hour12: false };
  %>
  <div class="period-text clamp-2">
    <%= start.toLocaleDateString('en-US', dateOpts) %>
    <%= start.toLocaleTimeString('en-US', timeOpts) %>
    <br /> &mdash;
    <%= end.toLocaleDateString('en-US', dateOpts) %>
    <%= end.toLocaleTimeString('en-US', timeOpts) %>
  </div>
</td>
                <td>
                  <%= days %>
                </td>
                <td>$<%= rate.toFixed(2) %>
                </td>
                <td>$<%= totalFee %>
                </td>
                <td>
                  <%= session.status.charAt(0).toUpperCase() + session.status.slice(1) %>
                </td>
                <td>
                  <%= new Date(session.createdAt).toLocaleString() %>
                </td>
              </tr>
              <% }); %>
          </tbody>
        </table>
        <% } %>
  </section>
  </main>

  <%- include('../partials/footer.ejs') %>